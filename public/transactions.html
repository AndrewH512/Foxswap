<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Transactions - Foxswap</title>
    <link rel="stylesheet" href="css/front-end.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <style>
        /* Center the main content container */
        .main-container {
            width: 80%;
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }

        .transaction-item {
            background-color: #f4f4f4;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: flex-start;
            text-align: left;
            gap: 20px;
        }

        .cover-picture {
            width: 80px;
            height: 100px;
            object-fit: cover;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .search-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .search-bar {
            padding: 10px;
            width: 50%;
            font-size: 16px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        .admin-button {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            font-size: 16px;
            background-color: #e90606;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
        }

        .admin-button:hover {
            background-color: #45a049;
        }
    </style>
</head>

<body>
    <header>
        <h1>View Transaction</h1>
        <a href="homepage.html"><img src="uploads/Fox_Swap_Logo.ico" alt="Logo" class="logo" style="width: 90px; height: 90px; position: absolute; top: 20px; left: 20px;" /></a>
    </header>

    <nav id="navbar">
        <!-- Navigation links will be dynamically inserted here -->
    </nav>

    <div class="main-container">
        <div>
            <!-- Search bar and filtering -->
            <div class="search-container">
                <h2>Search by Transaction ID</h2>
                <input type="text" id="search-bar" class="search-bar" placeholder="Search by transaction number" onkeyup="filterTransactions()" />
            </div>

            <div class="main-content">
                <!-- Transaction data will be dynamically inserted here -->
            </div>

            <!-- Back to admin home button -->
            <button class="admin-button" onclick="redirectTo('admin_home.html')">Admin Homepage</button>
    </div>

    <!-- Footer section -->
    <div id="footer-placeholder"></div>

    <script>
        let allTransactions = []; // Array to store all transactions

        // Function to fetch and display transactions
        function loadTransactions() {
            fetch('/api/viewTran', { method: 'GET' })
                .then(response => response.json())
                .then(data => {
                    allTransactions = data; // Store all transactions for filtering
                    displayTransactions(data); // Display all transactions initially
                })
                .catch(error => {
                    console.error('Error fetching transactions:', error);
                    const transactionsContainer = document.querySelector('.main-content');
                    transactionsContainer.innerHTML = '<p>Error loading transactions. Please try again later.</p>';
                });
        }

        // Function to display transactions
        function displayTransactions(transactions) {
            const transactionsContainer = document.querySelector('.main-content');
            transactionsContainer.innerHTML = ''; // Clear existing content

            if (transactions.length > 0) {
                transactions.forEach(transaction => {
                    const transactionDiv = document.createElement('div');
                    transactionDiv.classList.add('transaction-item');
                    transactionDiv.innerHTML = `
                        <img src="${transaction.Cover_Picture || 'default-cover.jpg'}" alt="Book Cover" class="cover-picture">
                        <div>
                            <h3>Transaction Number: ${transaction.Transaction_ID}</h3>
                            <p>The book "${transaction.Title}" was sold by ${transaction.Seller} and bought by ${transaction.Buyer} for the price of $${transaction.Transaction_Price}.</p>
                            <p><strong>Post Status:</strong> ${transaction.Post_Status}</p>
                            <p><strong>Book Condition:</strong> ${transaction.Book_Condition}</p>
                            <p><strong>Transaction Type:</strong> ${transaction.Transaction_Type}</p>
                            <p><strong>Due Date:</strong> ${transaction.Due_Date || 'N/A'}</p>
                        </div>
                    `;
                    transactionsContainer.appendChild(transactionDiv);
                });
            } else {
                transactionsContainer.innerHTML = '<p>No transactions found.</p>';
            }
        }

        // Function to filter transactions based on transaction number
        function filterTransactions() {
            const searchQuery = document.getElementById('search-bar').value.toLowerCase();
            const filteredTransactions = allTransactions.filter(transaction => {
                const transactionID = transaction.Transaction_ID.toString().toLowerCase();
                return transactionID.includes(searchQuery); // Only filter by transaction number
            });

            displayTransactions(filteredTransactions); // Display filtered transactions
        }

        // Load transactions when the page is loaded
        window.onload = loadTransactions;
    </script>

    <!-- Important Scripts -->
    <script src="js/window.js"></script>
    <script src="js/sessionCheck.js"></script>
    <script src="js/profilePicture.js"></script>
    <script src="js/searchUsers.js"></script>
    <script src="js/buttons.js"></script>

</body>

</html>